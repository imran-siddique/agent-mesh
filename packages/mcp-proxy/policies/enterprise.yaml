# AgentMesh MCP Proxy - Enterprise Policy
# 
# Full enterprise security: Rate limiting, PII detection, comprehensive audit.
# Use for production environments with compliance requirements.

version: "1.0"
mode: enforce

rules:
  # === COMPLETELY BLOCKED ===

  - tool: "run_shell"
    action: deny
    reason: "Shell execution prohibited per security policy SOC2-CC6.1"

  - tool: "execute_command"
    action: deny
    reason: "Command execution prohibited"

  - tool: "eval"
    action: deny
    reason: "Dynamic code evaluation prohibited"

  - tool: "spawn_process"
    action: deny
    reason: "Process spawning prohibited"

  # === SENSITIVE DATA PROTECTION ===

  - tool: "read_file"
    action: allow
    conditions:
      # Block access to sensitive file types
      - path_not_contains: 
        - ".env"
        - ".secret" 
        - "id_rsa"
        - "id_ed25519"
        - ".pem"
        - ".key"
        - "credentials"
        - "password"
        - "token"
        - ".aws"
        - ".azure"
        - ".gcp"
    rate_limit:
      requests: 50
      per: minute

  - tool: "write_file"
    action: allow
    conditions:
      - path_not_contains:
        - ".env"
        - ".secret"
        - "/etc/"
        - "/bin/"
        - "/usr/"
        - "C:\\Windows\\"
        - "C:\\Program Files\\"
    rate_limit:
      requests: 20
      per: minute

  - tool: "delete_file"
    action: deny
    reason: "File deletion requires manual approval"

  # === DATABASE OPERATIONS ===

  - tool: "query_database"
    action: allow
    conditions:
      # Block destructive queries
      - argument_not_matches:
          query: "(?i)(DROP|DELETE|TRUNCATE|ALTER|CREATE)\\s+"
    rate_limit:
      requests: 30
      per: minute

  # === NETWORK OPERATIONS ===

  - tool: "http_request"
    action: allow
    rate_limit:
      requests: 20
      per: minute

  - tool: "web_search"
    action: allow
    rate_limit:
      requests: 5
      per: minute

  # === CODE OPERATIONS ===

  - tool: "git_*"
    action: allow
    rate_limit:
      requests: 30
      per: minute

  # === DEFAULT ===

  - tool: "*"
    action: allow
    rate_limit:
      requests: 10
      per: minute

# Global rate limits
rate_limits:
  global:
    requests: 200
    per: minute

# Audit settings
audit:
  # Log all tool calls (not just violations)
  log_all: true
  # Include argument values (may contain sensitive data)
  include_arguments: true
  # Redact these fields in logs
  redact_fields:
    - password
    - secret
    - token
    - api_key
    - credential
