---
apiVersion: v1
kind: Namespace
metadata:
  name: my-app
  labels:
    agentmesh-inject: enabled

---
apiVersion: mesh.agentmesh.ai/v1
kind: GovernedAgent
metadata:
  name: data-processor
  namespace: my-app
  labels:
    app: data-processor
    team: data-engineering
    compliance: soc2
spec:
  # Container image for the agent
  image: my-company/data-processor:v1.2.0
  
  # Human sponsor responsible for this agent
  sponsor: "alice@company.com"
  
  # Capabilities this agent is authorized to use
  capabilities:
    - "s3:read"
    - "s3:list"
    - "api:analytics"
    - "db:read"
  
  # Policy to apply (standard, strict, permissive, or custom)
  policy: strict
  
  # Number of replicas
  replicas: 3
  
  # Resource requirements
  resources:
    limits:
      cpu: "1000m"
      memory: "1Gi"
    requests:
      cpu: "250m"
      memory: "256Mi"
  
  # Environment variables
  env:
    - name: LOG_LEVEL
      value: "INFO"
    - name: DATA_SOURCE
      value: "s3://my-bucket/data"
    - name: API_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: api-credentials
          key: endpoint
  
  # Sidecar configuration
  sidecar:
    enabled: true
    image: agentmesh/sidecar:1.0.0-alpha1
    resources:
      limits:
        cpu: "100m"
        memory: "128Mi"
      requests:
        cpu: "50m"
        memory: "64Mi"
  
  # Trust score configuration
  trustScore:
    initialScore: 500
    minimumScore: 300
  
  # Observability configuration
  observability:
    traces: true
    metrics: true
    logs: true

---
# Example secret for API credentials
apiVersion: v1
kind: Secret
metadata:
  name: api-credentials
  namespace: my-app
type: Opaque
stringData:
  endpoint: "https://analytics-api.company.com"
  api-key: "YOUR_API_KEY_HERE"
