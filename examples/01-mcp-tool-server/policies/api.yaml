policies:
  - id: "api-access-control"
    name: "API Access Control"
    version: "1.0.0"
    enabled: true
    
    rules:
      - id: "rate-limit-per-endpoint"
        name: "Per-Endpoint Rate Limiting"
        action: "block"
        conditions:
          - "tool == 'api_call'"
          - "count(tool='api_call', params.endpoint=params.endpoint, window='1h') > 50"
        message: "Per-endpoint rate limit exceeded (50 calls/hour)"
        severity: "medium"
      
      - id: "block-internal-apis"
        name: "Block Internal API Access"
        action: "block"
        conditions:
          - "tool == 'api_call'"
          - "params.endpoint starts_with 'http://localhost'"
          - "params.endpoint starts_with 'http://127.0.0.1'"
          - "params.endpoint starts_with 'http://192.168'"
          - "params.endpoint starts_with 'http://10.'"
        message: "Access to internal APIs is blocked"
        severity: "high"
      
      - id: "require-https"
        name: "Require HTTPS for API Calls"
        action: "block"
        conditions:
          - "tool == 'api_call'"
          - "params.endpoint starts_with 'http://'"
          - "not params.endpoint starts_with 'https://'"
        message: "Only HTTPS endpoints are allowed"
        severity: "high"
      
      - id: "validate-api-response"
        name: "Validate API Response Size"
        action: "block"
        conditions:
          - "tool == 'api_call'"
          - "response.size > 10485760"  # 10 MB
        message: "API response too large (>10MB)"
        severity: "medium"
      
      - id: "log-external-api-calls"
        name: "Audit External API Calls"
        action: "audit"
        conditions:
          - "tool == 'api_call'"
        message: "External API call logged"
        severity: "info"
