# Default values for agentmesh
# Production-grade defaults for enterprise deployment.

# -- Global configuration
global:
  namespace: agentmesh
  imagePullSecrets: []
  imageTag: "0.3.0"
  tls:
    enabled: true
    certSecretName: agentmesh-tls
  spiffe:
    enabled: false
    trustDomain: agentmesh.local
    socketPath: /run/spire/sockets/agent.sock

nameOverride: ""
fullnameOverride: ""

# -- Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# -- Pod security defaults
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false

# ---------------------------------------------------------------------------
# Trust Engine
# ---------------------------------------------------------------------------
trustEngine:
  replicas: 2
  image:
    repository: agentmesh/trust-engine
    tag: ""  # defaults to global.imageTag
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8443
    metricsPort: 9090
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  livenessProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ---------------------------------------------------------------------------
# Policy Server
# ---------------------------------------------------------------------------
policyServer:
  replicas: 2
  image:
    repository: agentmesh/policy-server
    tag: ""
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8444
    metricsPort: 9091
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  # Mount path for YAML policy files inside the container
  policyMountPath: /etc/agentmesh/policies
  livenessProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ---------------------------------------------------------------------------
# Audit Collector
# ---------------------------------------------------------------------------
auditCollector:
  replicas: 1
  image:
    repository: agentmesh/audit-collector
    tag: ""
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8445
    metricsPort: 9092
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistence:
    enabled: true
    storageClass: ""
    size: 10Gi
    accessModes:
      - ReadWriteOnce
  retentionDays: 90
  livenessProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ---------------------------------------------------------------------------
# API Gateway
# ---------------------------------------------------------------------------
apiGateway:
  replicas: 2
  image:
    repository: agentmesh/api-gateway
    tag: ""
    pullPolicy: IfNotPresent
  service:
    type: LoadBalancer
    port: 443
    metricsPort: 9093
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  rateLimitPerMinute: 1000
  livenessProbe:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ---------------------------------------------------------------------------
# Monitoring
# ---------------------------------------------------------------------------
monitoring:
  prometheus:
    enabled: true
    scrapeInterval: 15s
  serviceMonitor:
    enabled: false
    namespace: ""
    additionalLabels: {}

# ---------------------------------------------------------------------------
# Autoscaling (HPA)
# ---------------------------------------------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70

# ---------------------------------------------------------------------------
# Pod Disruption Budget
# ---------------------------------------------------------------------------
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# ---------------------------------------------------------------------------
# Network Policy
# ---------------------------------------------------------------------------
networkPolicy:
  enabled: true
